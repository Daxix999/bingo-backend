# ðŸŽ² GENERADOR DE TABLAS DE BINGO - PROYECTO COMPLETO

## ðŸ“‹ ÃNDICE
1. [Archivos de ConfiguraciÃ³n](#configuraciÃ³n)
2. [Backend - Controllers](#backend-controllers)
3. [Backend - Routes](#backend-routes)
4. [Backend - Middleware](#backend-middleware)
5. [Backend - Services](#backend-services)
6. [Frontend - HTML](#frontend-html)
7. [Frontend - JavaScript](#frontend-js)
8. [Frontend - CSS](#frontend-css)
9. [Instrucciones de InstalaciÃ³n](#instalaciÃ³n)
10. [Despliegue en la Nube](#despliegue)

---

# CONFIGURACIÃ“N

## ðŸ“„ backend/.env.example
```env
# ============================================================
# VARIABLES DE ENTORNO - GENERADOR DE BINGO
# Copia este archivo como .env y configura tus valores
# ============================================================

# ------------------------------------------------------------
# ConfiguraciÃ³n del servidor
# ------------------------------------------------------------
NODE_ENV=development
PORT=5000

# ------------------------------------------------------------
# URL del frontend (para CORS)
# ------------------------------------------------------------
FRONTEND_URL=http://localhost:3000

# ------------------------------------------------------------
# ConfiguraciÃ³n de la base de datos MySQL
# IMPORTANTE: Cambia estos valores segÃºn tu hosting
# ------------------------------------------------------------
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=tu_password_aqui
DB_NAME=bingo_generator

# ------------------------------------------------------------
# Secreto para JWT (tokens de autenticaciÃ³n)
# Genera uno aleatorio con: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# ------------------------------------------------------------
JWT_SECRET=tu_secreto_super_seguro_aqui_cambialo
JWT_EXPIRE=7d

# ------------------------------------------------------------
# ConfiguraciÃ³n de costos (crÃ©ditos)
# ------------------------------------------------------------
COSTO_PDF_PRUEBA=0
COSTO_PDF_FINAL=5
CREDITOS_INICIALES=0

# ------------------------------------------------------------
# ConfiguraciÃ³n de archivos
# ------------------------------------------------------------
MAX_FILE_SIZE=10485760
UPLOAD_PATH=./uploads
PDF_PATH=./pdfs
```

## ðŸ“„ backend/package.json
```json
{
  "name": "bingo-generator-backend",
  "version": "1.0.0",
  "description": "Backend para generador de tablas de bingo",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": ["bingo", "generator", "pdf"],
  "author": "Tu Nombre",
  "license": "ISC",
  "dependencies": {
    "bcrypt": "^5.1.1",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "express-fileupload": "^1.4.3",
    "helmet": "^7.1.0",
    "jsonwebtoken": "^9.0.2",
    "morgan": "^1.10.0",
    "mysql2": "^3.6.5",
    "puppeteer": "^21.6.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.2"
  }
}
```

## ðŸ“„ frontend/package.json (opcional, si usas build tools)
```json
{
  "name": "bingo-generator-frontend",
  "version": "1.0.0",
  "description": "Frontend para generador de tablas de bingo",
  "scripts": {
    "start": "live-server --port=3000"
  },
  "keywords": ["bingo", "frontend"],
  "author": "Tu Nombre",
  "license": "ISC"
}
```

---

# BACKEND CONTROLLERS

## ðŸ“„ backend/controllers/authController.js
```javascript
// ============================================================
// CONTROLADOR DE AUTENTICACIÃ“N
// Archivo: backend/controllers/authController.js
// DescripciÃ³n: Maneja registro, login y logout de usuarios
// ============================================================

const bcrypt = require('bcrypt');
const jwt = require('jsonwebtoken');
const db = require('../config/database');

// ------------------------------------------------------------
// MÃ©todo para registrar un nuevo usuario
// POST /api/auth/register
// ------------------------------------------------------------
const registrarUsuario = async (req, res) => {
    try {
        const { nombre, email, password } = req.body;
        
        // Validar que todos los campos estÃ©n presentes
        if (!nombre || !email || !password) {
            return res.status(400).json({
                error: 'Todos los campos son obligatorios'
            });
        }
        
        // Validar formato de email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            return res.status(400).json({
                error: 'Formato de email invÃ¡lido'
            });
        }
        
        // Validar longitud de contraseÃ±a
        if (password.length < 6) {
            return res.status(400).json({
                error: 'La contraseÃ±a debe tener al menos 6 caracteres'
            });
        }
        
        // Verificar si el email ya existe
        const usuarioExistente = await db.obtenerUno(
            'SELECT id FROM usuarios WHERE email = ?',
            [email]
        );
        
        if (usuarioExistente) {
            return res.status(409).json({
                error: 'Este email ya estÃ¡ registrado'
            });
        }
        
        // Encriptar contraseÃ±a con bcrypt (10 rondas)
        const passwordHash = await bcrypt.hash(password, 10);
        
        // Obtener crÃ©ditos iniciales de la configuraciÃ³n
        const config = await db.obtenerUno(
            'SELECT valor FROM configuracion WHERE clave = ?',
            ['creditos_inicial']
        );
        const creditosIniciales = parseInt(config?.valor || 0);
        
        // Insertar nuevo usuario en la base de datos
        const usuarioId = await db.insertar('usuarios', {
            nombre,
            email,
            password_hash: passwordHash,
            creditos: creditosIniciales,
            es_admin: 0,
            activo: 1
        });
        
        // Generar token JWT para el nuevo usuario
        const token = jwt.sign(
            { id: usuarioId, email, es_admin: false },
            process.env.JWT_SECRET,
            { expiresIn: process.env.JWT_EXPIRE || '7d' }
        );
        
        res.status(201).json({
            mensaje: 'Usuario registrado exitosamente',
            usuario: {
                id: usuarioId,
                nombre,
                email,
                creditos: creditosIniciales,
                es_admin: false
            },
            token
        });
        
    } catch (error) {
        console.error('Error en registrarUsuario:', error);
        res.status(500).json({
            error: 'Error al registrar usuario',
            mensaje: error.message
        });
    }
};

// ------------------------------------------------------------
// MÃ©todo para iniciar sesiÃ³n (login)
// POST /api/auth/login
// ------------------------------------------------------------
const login = async (req, res) => {
    try {
        const { email, password } = req.body;
        
        // Validar que email y password estÃ©n presentes
        if (!email || !password) {
            return res.status(400).json({
                error: 'Email y contraseÃ±a son obligatorios'
            });
        }
        
        // Buscar usuario por email
        const usuario = await db.obtenerUno(
            'SELECT id, nombre, email, password_hash, creditos, es_admin, activo FROM usuarios WHERE email = ?',
            [email]
        );
        
        if (!usuario) {
            return res.status(401).json({
                error: 'Email o contraseÃ±a incorrectos'
            });
        }
        
        // Verificar que la cuenta estÃ© activa
        if (!usuario.activo) {
            return res.status(403).json({
                error: 'Tu cuenta estÃ¡ inactiva. Contacta al administrador'
            });
        }
        
        // Comparar contraseÃ±a con el hash almacenado
        const passwordValida = await bcrypt.compare(password, usuario.password_hash);
        
        if (!passwordValida) {
            return res.status(401).json({
                error: 'Email o contraseÃ±a incorrectos'
            });
        }
        
        // Generar token JWT
        const token = jwt.sign(
            { 
                id: usuario.id, 
                email: usuario.email, 
                es_admin: usuario.es_admin 
            },
            process.env.JWT_SECRET,
            { expiresIn: process.env.JWT_EXPIRE || '7d' }
        );
        
        res.json({
            mensaje: 'Login exitoso',
            usuario: {
                id: usuario.id,
                nombre: usuario.nombre,
                email: usuario.email,
                creditos: usuario.creditos,
                es_admin: Boolean(usuario.es_admin)
            },
            token
        });
        
    } catch (error) {
        console.error('Error en login:', error);
        res.status(500).json({
            error: 'Error al iniciar sesiÃ³n',
            mensaje: error.message
        });
    }
};

// ------------------------------------------------------------
// MÃ©todo para verificar el token actual
// GET /api/auth/verify
// ------------------------------------------------------------
const verificarToken = async (req, res) => {
    try {
        // El usuario ya fue autenticado por el middleware
        const usuarioId = req.usuario.id;
        
        // Obtener datos actualizados del usuario
        const usuario = await db.obtenerUno(
            'SELECT id, nombre, email, creditos, es_admin, activo FROM usuarios WHERE id = ?',
            [usuarioId]
        );
        
        if (!usuario || !usuario.activo) {
            return res.status(401).json({
                error: 'Usuario no vÃ¡lido'
            });
        }
        
        res.json({
            valido: true,
            usuario: {
                id: usuario.id,
                nombre: usuario.nombre,
                email: usuario.email,
                creditos: usuario.creditos,
                es_admin: Boolean(usuario.es_admin)
            }
        });
        
    } catch (error) {
        console.error('Error en verificarToken:', error);
        res.status(500).json({
            error: 'Error al verificar token'
        });
    }
};

// ------------------------------------------------------------
// Exportar funciones del controlador
// ------------------------------------------------------------
module.exports = {
    registrarUsuario,
    login,
    verificarToken
};
```

---

## ðŸ“„ backend/controllers/creditController.js
```javascript
// ============================================================
// CONTROLADOR DE CRÃ‰DITOS
// Archivo: backend/controllers/creditController.js
// DescripciÃ³n: Maneja consultas y transacciones de crÃ©ditos
// ============================================================

const db = require('../config/database');

// ------------------------------------------------------------
// MÃ©todo para obtener el saldo de crÃ©ditos del usuario
// GET /api/credits/balance
// ------------------------------------------------------------
const obtenerSaldo = async (req, res) => {
    try {
        const usuarioId = req.usuario.id;
        
        // Consultar crÃ©ditos actuales del usuario
        const usuario = await db.obtenerUno(
            'SELECT creditos FROM usuarios WHERE id = ?',
            [usuarioId]
        );
        
        if (!usuario) {
            return res.status(404).json({
                error: 'Usuario no encontrado'
            });
        }
        
        res.json({
            creditos: usuario.creditos
        });
        
    } catch (error) {
        console.error('Error en obtenerSaldo:', error);
        res.status(500).json({
            error: 'Error al obtener saldo de crÃ©ditos'
        });
    }
};

// ------------------------------------------------------------
// MÃ©todo para obtener historial de transacciones
// GET /api/credits/history
// ------------------------------------------------------------
const obtenerHistorial = async (req, res) => {
    try {
        const usuarioId = req.usuario.id;
        const { limite = 50, pagina = 1 } = req.query;
        
        const offset = (pagina - 1) * limite;
        
        // Consultar transacciones del usuario
        const transacciones = await db.ejecutarConsulta(
            `SELECT 
                id,
                tipo,
                cantidad,
                descripcion,
                fecha
            FROM transacciones_creditos
            WHERE usuario_id = ?
            ORDER BY fecha DESC
            LIMIT ? OFFSET ?`,
            [usuarioId, parseInt(limite), offset]
        );
        
        // Contar total de transacciones
        const [{ total }] = await db.ejecutarConsulta(
            'SELECT COUNT(*) as total FROM transacciones_creditos WHERE usuario_id = ?',
            [usuarioId]
        );
        
        res.json({
            transacciones,
            paginacion: {
                pagina: parseInt(pagina),
                limite: parseInt(limite),
                total,
                totalPaginas: Math.ceil(total / limite)
            }
        });
        
    } catch (error) {
        console.error('Error en obtenerHistorial:', error);
        res.status(500).json({
            error: 'Error al obtener historial'
        });
    }
};

// ------------------------------------------------------------
// Exportar funciones del controlador
// ------------------------------------------------------------
module.exports = {
    obtenerSaldo,
    obtenerHistorial
};
```

Â¿Quieres que continÃºe con todos los demÃ¡s archivos? Te faltan:
- âœ… MÃ¡s controllers (template, lot, admin, user)
- âœ… Routes completos
- âœ… Middleware de autenticaciÃ³n
- âœ… Services (PDF generator, number generator)
- âœ… Frontend completo (HTML, CSS, JS)
- âœ… GuÃ­a de instalaciÃ³n paso a paso

Â¿Sigo creando los archivos restantes?